openapi: 3.0.0
info:
  title: Quiz API
  description: A comprehensive API for managing users, quizzes, questions, and attempts.
  version: 1.0.0
servers:
  - url: http://localhost:5000/api/v1
    description: Development server
tags:
  - name: User & Auth
    description: "Endpoints for user authentication and profile management."
  - name: User Management
    description: "Endpoints for managing users (profiles, status, and related data)."
  - name: Admin Quiz Management
    description: "Endpoints for administrators to create, update, and manage quizzes."
  - name: Admin Question Management
    description: "Endpoints for administrators to manage questions within quizzes."
  - name: Quizzes
    description: "Publicly accessible endpoints for Browse and viewing quizzes."
  - name: Quiz Attempts
    description: "Endpoints for users to attempt quizzes and view results."

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Enter JWT token in the format: Bearer <token>"

  schemas:
    # --- ENUMS ---
    QuizSetLabel:
      type: string
      enum: [easy, medium, hard]
      description: The difficulty label for a quiz set.
    QuizSetStatus:
      type: string
      enum: [draft, published]
      description: The publication status of a quiz set.
    UserRole:
      type: string
      enum: [admin, user]
      description: The role of a user in the system.

    # --- CORE MODELS ---
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        fullName:
          type: string
        email:
          type: string
          format: email
        bio:
          type: string
          nullable: true
        photo:
          type: string
          nullable: true
        role:
          $ref: "#/components/schemas/UserRole"
        isBanned:
          type: boolean
          description: "Indicates if the user is banned from the platform."
          default: false
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Question:
      type: object
      properties:
        id:
          type: string
          format: uuid
        quizSetId:
          type: string
          format: uuid
        question:
          type: string
        options:
          type: array
          items:
            oneOf:
              - type: string
              - type: number
        correctAnswers:
          type: array
          items:
            type: integer
          description: Array of indices corresponding to the correct options.
        mark:
          type: number
        time:
          type: integer
          description: Time limit for the question in seconds.
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    QuizSet:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        category:
          type: array
          items:
            type: string
        status:
          $ref: "#/components/schemas/QuizSetStatus"
        label:
          $ref: "#/components/schemas/QuizSetLabel"
        userId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        user:
          $ref: "#/components/schemas/User"
        questions:
          type: array
          items:
            $ref: "#/components/schemas/Question"
        ratings:
          type: array
          items:
            $ref: "#/components/schemas/QuizSetRating"
        attempts:
          type: array
          items:
            $ref: "#/components/schemas/Attempt"

    QuizSetRating:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        quizId:
          type: string
          format: uuid
        rating:
          type: integer
          minimum: 0
          maximum: 5
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    SubmittedAnswer:
      type: object
      properties:
        questionId:
          type: string
          format: uuid
        selectedAnswers:
          type: array
          items:
            type: string
          description: The indices of the answers selected by the user.

    Attempt:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        quizId:
          type: string
          format: uuid
        score:
          type: number
        correct:
          type: integer
        wrong:
          type: integer
        skipped:
          type: integer
        submittedAnswers:
          type: array
          items:
            $ref: "#/components/schemas/SubmittedAnswer"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # --- REQUEST/RESPONSE SCHEMAS ---
    UserRegistration:
      type: object
      required: [fullName, email, password]
      properties:
        fullName:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password

    UpdateUserProfile:
      type: object
      properties:
        fullName:
          type: string
        bio:
          type: string
          nullable: true
        photo:
          type: string
          nullable: true

    UserLogin:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password

    LoginResponse:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        user:
          $ref: "#/components/schemas/User"

    RefreshToken:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string

    RefreshTokenResponse:
      type: object
      properties:
        accessToken:
          type: string

    CreateQuizSet:
      type: object
      required: [title, description, category, status, label]
      properties:
        title:
          type: string
        description:
          type: string
        category:
          type: array
          items:
            type: string
        status:
          $ref: "#/components/schemas/QuizSetStatus"
        label:
          $ref: "#/components/schemas/QuizSetLabel"

    UpdateQuizSet:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        category:
          type: array
          items:
            type: string
        status:
          $ref: "#/components/schemas/QuizSetStatus"
        label:
          $ref: "#/components/schemas/QuizSetLabel"

    CreateQuestion:
      type: object
      required: [question, options, correctAnswers, mark, time]
      properties:
        question:
          type: string
        options:
          type: array
          items:
            oneOf:
              - type: string
              - type: number
        correctAnswers:
          type: array
          items:
            type: integer
        mark:
          type: number
        time:
          type: integer

    SubmitAttempt:
      type: object
      required: [submittedAnswers]
      properties:
        submittedAnswers:
          type: array
          items:
            $ref: "#/components/schemas/SubmittedAnswer"

    ErrorResponse:
      type: object
      properties:
        statusCode:
          type: integer
        message:
          type: string
        error:
          type: string

  responses:
    UnauthorizedError:
      description: "Authentication information is missing or invalid."
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    ForbiddenError:
      description: "User is not authorized to perform this action (e.g., not an admin)."
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFoundError:
      description: "The requested resource was not found."
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

# API Routes
paths:
  # --- User Authentication Routes ---
  /auth/register:
    post:
      tags: [User & Auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRegistration"
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Bad request or user already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /auth/login:
    post:
      tags: [User & Auth]
      summary: Login a user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserLogin"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /auth/refresh-token:
    post:
      tags: [User & Auth]
      summary: Get a new access token using a refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshToken"
      responses:
        "200":
          description: New access token generated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RefreshTokenResponse"
        "401":
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /auth/me:
    get:
      tags: [User & Auth]
      summary: Get current user's profile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/UnauthorizedError"

  # --- User Management Routes ---
  /users:
    get:
      tags: [User Management]
      summary: Get all users
      description: Retrieves a list of all users. Requires ADMIN role.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: A list of users.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"

  /users/{id}:
    get:
      tags: [User Management]
      summary: Get user by ID
      description: Retrieves a user's profile. Requires ADMIN role or for the user to be the owner of the resource.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: User profile retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"
    put:
      tags: [User Management]
      summary: Update user by ID
      description: Updates a user's profile. Requires ADMIN role or for the user to be the owner of the resource.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserProfile"
      responses:
        "200":
          description: User profile updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"
    delete:
      tags: [User Management]
      summary: Delete user by ID
      description: Deletes a user. Requires ADMIN role or for the user to be the owner of the resource.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: User deleted successfully.
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  /users/{id}/quizzes:
    get:
      tags: [User Management]
      summary: Get all quizzes created by a user
      description: Retrieves all quizzes created by a specific user. Requires ADMIN role or for the user to be the owner of the resource.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: A list of quizzes created by the user.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/QuizSet"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  /users/{id}/attempts:
    get:
      tags: [User Management]
      summary: Get all quiz attempts by a user
      description: Retrieves all quiz attempts made by a specific user. Requires ADMIN role or for the user to be the owner of the resource.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: A list of attempts made by the user.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Attempt"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  /users/{id}/ratings:
    get:
      tags: [User Management]
      summary: Get all ratings submitted by a user
      description: Retrieves all ratings submitted by a specific user. Requires ADMIN role or for the user to be the owner of the resource.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: A list of ratings submitted by the user.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/QuizSetRating"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  /users/{id}/ban:
    post:
      tags: [User Management]
      summary: Ban a user
      description: Marks a user as banned. Requires ADMIN role.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: User banned successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  /users/{id}/unban:
    post:
      tags: [User Management]
      summary: Unban a user
      description: Re-instates a banned user. Requires ADMIN role.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: User unbanned successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  # --- Admin Quiz Management ---
  /admin/quizzes:
    get:
      tags: [Admin Quiz Management]
      summary: List all quizzes (admin only)
      security:
        - bearerAuth: []
      responses:
        "200":
          description: A list of all quizzes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/QuizSet"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
    post:
      tags: [Admin Quiz Management]
      summary: Create a new quiz (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateQuizSet"
      responses:
        "201":
          description: Quiz created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QuizSet"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
  /admin/quizzes/{id}:
    patch:
      tags: [Admin Quiz Management]
      summary: Update a quiz (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateQuizSet"
      responses:
        "200":
          description: Quiz updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QuizSet"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"
    delete:
      tags: [Admin Quiz Management]
      summary: Delete a quiz (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Quiz deleted successfully
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  # --- Admin Question Management ---
  /admin/quizzes/{quizId}/questions:
    post:
      tags: [Admin Question Management]
      summary: Add a question to a quiz (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: quizId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateQuestion"
      responses:
        "201":
          description: Question added
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Question"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
  /admin/quizzes/{quizId}/questions/bulk:
    post:
      tags: [Admin Question Management]
      summary: Add multiple questions to a quiz (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: quizId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CreateQuestion"
      responses:
        "201":
          description: Questions added
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Question"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
  /admin/quizzes/{quizId}/questions/{questionId}:
    patch:
      tags: [Admin Question Management]
      summary: Edit a question in a quiz (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: quizId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: questionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateQuestion" # Can reuse this, or create a specific update schema
      responses:
        "200":
          description: Question updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Question"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
    delete:
      tags: [Admin Question Management]
      summary: Delete a question from a quiz (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: quizId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: questionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Question deleted
        "401":
          $ref: "#/components/responses/UnauthorizedError"

  # --- Public Quiz Routes ---
  /quizzes:
    get:
      tags: [Quizzes]
      summary: List all published quizzes
      responses:
        "200":
          description: A list of published quizzes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/QuizSet"
  /quizzes/{id}:
    get:
      tags: [Quizzes]
      summary: Get a specific quiz by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Quiz details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QuizSet"
        "404":
          $ref: "#/components/responses/NotFoundError"
  /quizzes/{quizId}/leaderboard:
    get:
      tags: [Quizzes]
      summary: Get the leaderboard for a quiz
      parameters:
        - name: quizId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Leaderboard data
          content:
            application/json:
              schema:
                type: array
                items:
                  # Assuming leaderboard returns a list of attempts
                  $ref: "#/components/schemas/Attempt"
        "404":
          $ref: "#/components/responses/NotFoundError"

  # --- Quiz Attempt Routes ---
  /quizzes/{id}/attempts:
    get:
      tags: [Quiz Attempts]
      summary: Get all attempts for a specific quiz
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: A list of attempts for the quiz
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Attempt"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
  /quizzes/{quizId}/attempt:
    post:
      tags: [Quiz Attempts]
      summary: Submit an attempt for a quiz
      security:
        - bearerAuth: []
      parameters:
        - name: quizId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SubmitAttempt"
      responses:
        "201":
          description: Attempt submitted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Attempt"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
  /quizzes/attempts:
    get:
      tags: [Quiz Attempts]
      summary: Get all attempts for the current user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: A list of the user's attempts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Attempt"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
  /quizzes/attempts/{quizId}:
    get:
      tags: [Quiz Attempts]
      summary: Get the current user's attempts for a specific quiz
      security:
        - bearerAuth: []
      parameters:
        - name: quizId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: User's attempts for the specified quiz
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Attempt"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
